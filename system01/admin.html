<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>새담 강사경력증명서 발급</title>
  <link href="https://fonts.googleapis.com/css2?family=Dongle&display=swap" rel="stylesheet">
  <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<style>
 
body {
  font-family: 'Nanum Gothic', sans-serif;
  background-color: #000; /* 필요 시 제거 가능 */
  background-image: url("https://www.saedam.org/img_sub/Kakao_friendsbg4k.png");
  background-repeat: repeat;
  background-size: auto;
  background-position: center top;
  margin: 0;
  padding: 0;
}
    .container {
      width: 1700px;   /* ✅ 메인 데이터 테이블 가로크기===================== */
      margin: 20px auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      margin-top: 250px; /* ✅ 바깥쪽 위 여백 */
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      word-break: break-word;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 13px;
    }

    th {
      background-color: #fce473;
    }

    /* 마우스오버 시 애니메이션 */
    tbody tr {
      transition: all 0.3s ease;
    }

    tbody tr:hover {
      background-color: #fff8cc;
    }

    tbody tr:hover td {
      position: relative;
    }

    tbody tr:hover td::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 2px;
      background: orange;
    }

  /* 공통 버튼 스타일 */
a.btn, button.btn {
  padding: 8px 14px;
  font-size: 13px;
  font-weight: 500;
  border-radius: 6px;
  border: 1px solid #ccc;
  background-color: white;
  color: #333;
  text-decoration: none;
  cursor: pointer;
  display: inline-block;
  transition: all 0.3s ease;

  min-width: 56px;   /* ✅ 너비 고정 */
  height: 34px;       /* ✅ 높이 고정 */

  text-align: center;
  box-sizing: border-box;
}

/* 삭제 버튼 - hover 시 빨간 계열 */
a.btn.btn-delete, button.btn.btn-delete {
  color: #f67280;
}
a.btn.btn-delete:hover, button.btn.btn-delete:hover {
  background-color: #f67280;
  color: white;
  border-color: #f67280;
}

/* 수정버튼 - hover 시 민트 계열 */
button.save {
  color: #55b79a;
}
button.save:hover {
  background-color: #a8e6cf;
  color: #2f4f4f;
  border-color: #a8e6cf;
}

/* 발급 버튼 - hover 시 파란 계열 */
a.btn.issue {
  color: #4a90e2;
}
a.btn.issue:hover {
  background-color: #4a90e2;
  color: white;
  border-color: #4a90e2;
}


/* 인풋버튼 스타일 지정 */
    input, select, textarea {
      border: none;
      background: transparent;
      width: 100%;
      font-family: inherit;
      font-size: inherit;
      text-align: center;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
    }

    .pagination {
      text-align: center;
      margin-top: 20px;
    }

    .pagination a, .pagination span {
      margin: 0 4px;
      font-weight: bold;
      color: #333;
    }

    img {
      width: auto; /* 카카오 이미지 크기 조정 */
      height: auto;
    }


.summary-pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 5px;
  font-size: 14px;
}

.summary {
  background-color: #fff;
  color: #007bff; /* ← 파란 텍스트 */
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px 12px;
  font-size: 14px;
  line-height: 1.4;
  margin-left: 10px;
  margin-top: 20px;
  text-align: left;
  display: inline-block;
}

.pagination a, .pagination span {
  display: inline-block;
  margin: 0 4px;
  padding: 6px 10px;
  border-radius: 4px;
  font-size: 14px;
  text-decoration: none;
  border: 1px solid #ccc;
}

.pagination .current-page {
  background-color: #007bff;
  color: white;
  border-color: #007bff;
}

.pdf-link {
  text-decoration: none;      /* 밑줄 제거 */
  color: #333;                /* 일반 텍스트 색상 */
  padding: 4px 8px;           /* 클릭 영역 넉넉히 */
  border-radius: 4px;         /* 모서리 약간 둥글게 */
  transition: background-color 0.3s;
}

.pdf-link:hover {
  color: #ff69b4; /* 밝은 핑크 (hotpink) */
}

#floatingContainer {   /* 둥둥 캐릭터와 말풍선  */
  position: absolute;
  top: 122px;   /* 둥둥 캐릭터 상하위치  */
  left: 100px;
  z-index: 9999;
  cursor: pointer;
  pointer-events: auto;
  transition: top 2s ease-in-out, left 2s ease-in-out;
}

#floatingAlert {
  max-height: 130px;
  object-fit: contain;
  display: block;
}

#floatingBalloon {
  position: absolute;
  top: -40px;  /* -값이 클수록 캐릭터와 간격커짐 */
  left: 50%;
  transform: translateX(-50%);
  background: #fff;
  border: 1px solid #ccc;
  padding: 4px 14px; /* 풍선 가로 세로 여백크기 */
  font-size: 20px;
  line-height: 1.1;
  font-family: 'Dongle', sans-serif;   /* Dongle 폰트 */
  border-radius: 16px;
  white-space: nowrap;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
  color: #4a90e2;   /* 폰트컬러 */
}

#floatingBalloon::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-top: 10px solid #fff;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
}

/* 구름 이미지 위치 및 크기 */
#cloudContainer {
  position: absolute;     /* 페이지 위에 고정되도록 */
  top: 0;
  left: 0;
  width: 100%;
  height: 120px;           /* 구름 높이 영역 설정 */
  pointer-events: none;
  z-index: 0;              /* 배경 요소처럼 뒤로 */
}

.floatingCloud {
  position: absolute;
  width: 160px;
  opacity: 0.95;
  animation: floatCloud 4s ease-in-out infinite;
}

/* 위아래 구름 둥실 애니메이션 */
@keyframes floatCloud {
  0%   { transform: translateY(0); }
  50%  { transform: translateY(-10px); }
  100% { transform: translateY(0); }
}


</style>


</head>
<body>

  <!-- 캐릭터 삽입 밑에 둥둥뜨기 스크립트 윗쪽에 위치해야함. -->
{% if pending_count > 0 %}
  <div id="floatingContainer">
    <div id="floatingBalloon">발급신청 {{ pending_count }}건요~!</div>
    <img id="floatingAlert" src="" alt="발급해야해요!" title="드래그 가능해요!">
  </div>
{% endif %}

<div id="cloudContainer">
  <img src="https://www.saedam.org/img_sub/cloud01.png" class="floatingCloud" style="top: 40px; left: 15%;">
  <img src="https://www.saedam.org/img_sub/cloud02.png" class="floatingCloud" style="top: 110px; left: 65%;">
  <img src="https://www.saedam.org/img_sub/cloud03.png" class="floatingCloud" style="top: 20px; left: 90%;">
</div>

  <!-- 상단 캐릭터 이미지 및 제목 -->
  <div class="header">

<!-- 이미지 + 텍스트 겹치기 구조 -->
<div style="position: relative; display: flex; justify-content: center; margin-top: 40px;">


  <!-- 텍스트 오버레이 -->
  <h1 style="
    position: absolute;
    top: -68px;  /* ← 이미지 위에서 아래로 얼마나 떨어질지 */
    left: 50%;
    transform: translateX(-50%);
    font-size: 32px;
    font-weight: bold;
    color: #333;
    background-color: rgba(255, 255, 255, 0.7);  /* 읽기 쉽게 흐린 배경 */
    padding: 10px 216px;
    border-radius: 10px;
    white-space: nowrap;
  ">
    새담 강사경력증명서 발급시스템
  </h1>
</div>
 </div>

  <div class="container">

  <table>
    <thead>
      <tr>
        <th style="width: 30px; height: 35px;">No</th>
        <th style="width: 70px;">신청일</th>
        <th style="width: 100px;">증명서종류</th>
        <th style="width: 70px;">성명</th>
        <th style="width: 100px;">주민번호</th>
        <th style="width: 120px;">직책</th>
        <th style="width: 80px;">과목</th>
        <th style="width: 85px;">용도</th>
        <th style="width: 100px;">장소</th>
        <th style="width: 80px;">근무시작일</th>
        <th style="width: 80px;">근무종료일</th>
        <th style="width: 30px;">메일</th>
        <th style="width: 70px;">종료사유</th>
        <th style="width: 85px;">상태<br>(발급번호)</th>
        <th style="width: 165px;">작업</th>
      </tr>
    </thead>
    <tbody>
      {% for row in submissions %}
      <form method="POST" action="/{{ system }}/update/{{ loop.index0 + (page - 1) * 10 }}">
      <input type="hidden" name="page" value="{{ page }}">
        <tr>
          <td style="height: 35px;">{{ (total_count - ((page - 1) * 10 + loop.index0)) }}</td>
          {% if row.상태 == "대기" %}
            <td><input type="text" name="신청일" value="{{ row.신청일 }}" readonly></td>
            <td><input type="text" name="증명서종류" value="{{ row.증명서종류 }}"></td>
            <td><input type="text" name="성명" value="{{ row.성명 }}" title="{{ row.자택주소 }}"></td>
            <td><input type="text" name="주민번호" value="{{ row.주민번호 }}"></td>
            <td><input type="text" name="직책" value="{{ row.직책 }}"></td>
            <td><input type="text" name="강의과목" value="{{ row.강의과목 }}"></td>
            <td><input type="text" name="용도" value="{{ row.용도 }}"></td>
            <td><input type="text" name="근무장소" value="{{ row.근무장소 }}"></td>
            <td><input type="text" name="근무시작일" value="{{ row.근무시작일 }}"></td>
            <td><input type="text" name="근무종료일" value="{{ row.근무종료일 }}"></td>
<td>
  <input type="hidden" name="이메일주소" value="{{ row.이메일주소 }}" id="email_{{ loop.index0 }}">
<img src="https://www.saedam.org/img_sub/mail.png"
     alt="메일"
     title="{{ row.이메일주소 }}"
     style="height: 15px; vertical-align: middle; cursor: pointer;"
     onclick="openEmailModal({{ loop.index0 + (page - 1) * 10 }}, '{{ row.이메일주소 }}')">
</td>
            <td><input type="text" name="종료사유" value="{{ row.종료사유 }}"></td>
          {% else %}
            <td>{{ row.신청일 }}</td>
            <td>{{ row.증명서종류 }}</td>
            <td title="{{ row.자택주소 }}">{{ row.성명 }}</td>
            <td>{{ row.주민번호 }}</td>
            <td>{{ row.직책 }}</td>     
            <td>{{ row.강의과목 }}</td>
            <td>{{ row.용도 }}</td>
            <td>{{ row.근무장소 }}</td>
            <td>{{ row.근무시작일 }}</td>
            <td>{{ row.근무종료일 }}</td>
                 <td><img src="https://www.saedam.org/img_sub/mail.png"
     alt="메일"
     title="{{ row.이메일주소 }}"
     style="height: 15px; vertical-align: middle; cursor: pointer;"
     onclick="copyEmailToClipboard(this)"
     data-email="{{ row.이메일주소 }}">
</td>
            <td>{{ row.종료사유 }}</td>
          {% endif %}
<td>
  {% if row.상태 == "발급완료" and row.발급번호 %}
<a class="pdf-link" href="/{{ system }}/pdf/{{ row.발급번호 }}_{{ row.성명 }}_{{ row.증명서종류.replace(' ', '') }}.pdf" target="_blank">
  {{ row.발급번호 }}
</a>
  {% else %}
    발급대기
  {% endif %}
</td>
          <td>
            {% if row.상태 == "대기" %}
              <a href="/{{ system }}/delete/{{ loop.index0 + (page - 1) * 10 }}?page={{ page }}" class="btn btn-delete">삭제</a>
              <button type="submit" class="btn save">수정</button>
              <a href="/{{ system }}/generate/{{ loop.index0 + (page - 1) * 10 }}?page={{ page }}" class="btn issue generate-btn">발급</a>
            {% else %}
              발급일: {{ row.발급일 }}
            {% endif %}
          </td>
        </tr>
      </form>
      {% endfor %}
    </tbody>
  </table>

<div class="summary-pagination">
  <div class="summary">
    총 신청 {{ total_count }}건 /
    발급완료 {{ issued_count }}건 /
    발급대기 {{ pending_count }}건  
<a href="/{{ system }}/logout" style="text-decoration: none; border: none; margin-left: 20px;">
  <img src="https://www.saedam.org/img_sub/logout2.png" alt="로그아웃" title="로그아웃" style="height: 10px; vertical-align: middle;">
</a>
  </div>

<!-- ✅ 개선된 페이지네이션 -->
<div class="pagination">
  {% if page > 1 %}
    <a href="/{{ system }}/admin/{{ page - 1 }}">« Prev</a>
  {% endif %}

  {% set start_page = page - 2 %}
  {% set end_page = page + 2 %}

  {# 시작 페이지 조정: 1보다 작으면 보정 #}
  {% if start_page < 1 %}
    {% set end_page = end_page + (1 - start_page) %}
    {% set start_page = 1 %}
  {% endif %}

  {# 끝 페이지 조정: total_pages보다 크면 보정 #}
  {% if end_page > total_pages %}
    {% set start_page = start_page - (end_page - total_pages) %}
    {% set end_page = total_pages %}
  {% endif %}

  {# 다시 한 번 시작 페이지 1보다 작아졌을 경우 보정 #}
  {% if start_page < 1 %}
    {% set start_page = 1 %}
  {% endif %}

  {# 페이지 출력 루프 (최대 5개 보장) #}
  {% for p in range(start_page, end_page + 1) %}
    {% if p == page %}
      <span class="current-page">{{ p }}</span>
    {% else %}
      <a href="/{{ system }}/admin/{{ p }}">{{ p }}</a>
    {% endif %}
  {% endfor %}

  {% if page < total_pages %}
    <a href="/{{ system }}/admin/{{ page + 1 }}">Next »</a>
  {% endif %}
</div>

</div></div>


<!-- 하단 영역 (로고 + 저작권 문구 수평 정렬) -->
<div style="
  display: flex;
  justify-content: center;    /* 전체 기준: 가운데 정렬 */
  align-items: center;        /* 수직 정렬 맞춤 */
  width: 100%;
  padding: 20px 40px;
  box-sizing: border-box;
  font-size: 13px;
  color: #555;
  position: relative;
">

  <!-- 새담로고 -->
  <div style="
    flex: 0 0 auto;
    text-align: center;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  ">
    <img src="https://www.saedam.org/img_sub/logo.gif" alt="로고" style="height: 48px; width: auto;">
  </div>

  <!-- 카피라이트 문구 -->
<div style="display: flex; justify-content: center; position: relative;">
  <div style="transform: translateX(720px); text-align: left;">
    Instructor Career Certificate Issuance System<br>
    Copyright©(사)새담청소년교육문화원. All Rights Reserved.
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const deleteButtons = document.querySelectorAll(".btn-delete");
    deleteButtons.forEach(function (btn) {
      btn.addEventListener("click", function (e) {
        if (!confirm("정말 삭제하시겠습니까?")) {
          e.preventDefault();
        }
      });
    });
  });
</script>

    <!-- 발급버튼 여러번 누르기 방지 -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const generateButtons = document.querySelectorAll(".generate-btn");

    generateButtons.forEach(function (btn) {
      btn.addEventListener("click", function (e) {
        // 이미 처리 중이면 막기
        if (btn.dataset.processing === "true") {
          e.preventDefault();
          return;
        }
        btn.innerHTML = `<img src="https://www.saedam.org/img_sub/loading.gif" style="width: 14px;">`;
        btn.style.pointerEvents = "none";  // 추가 클릭 방지
        btn.dataset.processing = "true";   // 중복 방지 플래그
      });
    });
  });
</script>

  <!-- 플래시 메시지 -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <script>
        alert("{{ messages[0] }}");
      </script>
    {% endif %}
  {% endwith %}


<script>      // 캐릭터 위치 설정 및 드래그만 가능 ======================

document.addEventListener("DOMContentLoaded", function () {
  const container = document.getElementById("floatingContainer");
  const alertImg = document.getElementById("floatingAlert");
  if (!container || !alertImg) return;

  // 랜덤 이미지 설정
  const randomNum = Math.floor(Math.random() * 7) + 1;
  alertImg.src = `https://www.saedam.org/img_sub/issue_alert0${randomNum}.png`;

  // ✅ 고정된 위치 기준에서 드래그 처리
  let isDragging = false;
  let offsetX = 0;
  let offsetY = 0;

  alertImg.addEventListener("mousedown", function (e) {
    isDragging = true;
    container.style.transition = "none";
    const rect = container.getBoundingClientRect(); // fixed 기준 위치
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
    e.preventDefault();
  });

  document.addEventListener("mousemove", function (e) {
    if (isDragging) {
      container.style.left = `${e.clientX - offsetX}px`;
      container.style.top = `${e.clientY - offsetY}px`;
    }
  });

  document.addEventListener("mouseup", function () {
    if (isDragging) {
      isDragging = false;
      container.style.transition = "top 2s ease-in-out, left 2s ease-in-out";
    }
  });
});
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const editButtons = document.querySelectorAll(".btn.save");
    editButtons.forEach(function (btn) {
      btn.addEventListener("click", function (e) {
        if (!confirm("수정하시겠습니까?")) {
          e.preventDefault();
        }
      });
    });
  });
</script>

  <!-- 창뛰워 이메일 수정하기 -->

<!-- 이메일 수정 모달창 -->
<div id="emailModal" style="display:none; position:fixed; top:40%; left:50%; transform:translate(-50%, -50%); background:#fff; padding:20px; border:1px solid #ccc; border-radius:10px; z-index:10000;">
  <h3>이메일 수정</h3>
  <form id="emailForm" method="POST">
    <input type="email" name="이메일주소" id="modalEmail" style="width:100%; padding:8px; font-size:14px;" required>
    <input type="hidden" name="index" id="modalIndex">
    <input type="hidden" name="page" value="{{ page }}">
    <br><br>
    <button type="submit">저장</button>
    <button type="button" onclick="closeEmailModal()">닫기</button>
  </form>
</div>

  <!-- 창뛰워 이메일 수정하기  ----->
<script>
function openEmailModal(index, email) {
  document.querySelector('#modalEmail').value = email;
  document.querySelector('#modalIndex').value = index;
  document.querySelector('#emailModal').style.display = 'block';

  const system = location.pathname.split('/')[1];  // 예: system01
  document.querySelector('#emailForm').action = `/${system}/update_email`;

  setTimeout(() => {
    document.querySelector('#modalEmail').focus();
  }, 100);
}
</script>
<script>
  function closeEmailModal() {
    document.getElementById("emailModal").style.display = "none";
  }
</script>
  <!-- 창뛰워 이메일 수정하기 끝 -->

  <!-- 이메일주소 클립보드 복사 -->
<script>
function copyEmailToClipboard(element) {
    const email = element.getAttribute('data-email');
    if (!email) return;

    // 클립보드에 복사
    navigator.clipboard.writeText(email)
        .then(() => {
            alert(`클립보드로 이메일 주소가 복사되었습니다:\n${email}`);
        })
        .catch(err => {
            console.error('클립보드 복사 실패:', err);
            alert('복사에 실패했습니다. 브라우저 권한을 확인해주세요.');
        });
}
</script>

<br><br><br><br>
</body>
</html>
